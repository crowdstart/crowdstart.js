!function(t){"use strict";var e,n=function(t){return"function"==typeof t},r=function(t){return 200===t.status},o=function(t){return 201===t.status},u="GET",i="POST",s=function(t,e,n){var r,o,u,i,s,c;return null==e&&(e={}),r=null!=(o=null!=(u=e.data)&&null!=(i=u.error)?i.message:void 0)?o:"Request failed",null==n&&(n=new Error(r)),n.data=e.data,n.msg=r,n.req=t,n.responseText=e.data,n.status=e.status,n.type=null!=(s=e.data)&&null!=(c=s.error)?c.type:void 0,n};e=function(t,e,n){var r,o,u;return o=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi"),o.test(t)?null!=n?t.replace(o,"$1"+e+"="+n+"$2$3"):(r=t.split("#"),t=r[0].replace(o,"$1$3").replace(/(&|\?)$/,""),null!=r[1]&&(t+="#"+r[1]),t):null!=n?(u=-1!==t.indexOf("?")?"&":"?",r=t.split("#"),t=r[0]+u+e+"="+n,null!=r[1]&&(t+="#"+r[1]),t):t};var c,l=function(t,n){var r,o;if("object"!=typeof n)return t;for(r in n)o=n[r],t=e(t,r,o);return t};c=function(){function t(e){var n,r,o,u;if(null==e&&(e={}),!(this instanceof t))return new t(e);n=e.blueprints,r=e.client,this.client=r||new this.constructor.CLIENT(e),null==n&&(n=this.constructor.BLUEPRINTS);for(o in n)u=n[o],this.addBlueprints(o,u)}return t.BLUEPRINTS={},t.CLIENT=null,t.prototype.addBlueprints=function(t,e){var n,r;null==this[t]&&(this[t]={});for(r in e)n=e[r],this.addBlueprint(t,r,n)},t.prototype.addBlueprint=function(t,e,o){var i;return n(o)?this[t][e]=function(t){return function(){return o.apply(t,arguments)}}(this):(null==o.expects&&(o.expects=r),null==o.method&&(o.method=u),i=function(t){return function(e,n){var r;return r=void 0,o.useCustomerToken&&(r=t.client.getCustomerToken()),t.client.request(o,e,r).then(function(n){var r,u;if(null!=(null!=(r=n.data)?r.error:void 0))throw s(e,n);if(!o.expects(n))throw s(e,n);return null!=o.process&&o.process.call(t,n),null!=(u=n.data)?u:n.body}).callback(n)}}(this),this[t][e]=i)},t.prototype.setKey=function(t){return this.client.setKey(t)},t.prototype.setCustomerToken=function(t){return this.client.setCustomerToken(t)},t.prototype.deleteCustomerToken=function(){return this.client.deleteCustomerToken()},t.prototype.setStore=function(t){return this.storeId=t,this.client.setStore(t)},t}();var a,p,f=c,h=a=function(){function t(t){this.state=t.state,this.value=t.value,this.reason=t.reason}return t.prototype.isFulfilled=function(){return"fulfilled"===this.state},t.prototype.isRejected=function(){return"rejected"===this.state},t}();p=function(){var t,e,n,r,o;return r=[],o=0,t=1024,e=function(){for(var e;r.length-o;){try{r[o]()}catch(t){e=t,"undefined"!=typeof console&&console.error(e)}r[o++]=void 0,o===t&&(r.splice(0,t),o=0)}},n=function(){var t,n;return"undefined"!=typeof MutationObserver?(t=document.createElement("div"),n=new MutationObserver(e),n.observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}):"undefined"!=typeof setImmediate?function(){setImmediate(e)}:function(){setTimeout(e,0)}}(),function(t){r.push(t),r.length-o==1&&n()}}();var d,v,y,m,g,x,T,w=p;g=void 0,y=g,v="fulfilled",m="rejected",T=function(t,e){var n,r;if("function"==typeof t.y)try{r=t.y.call(g,e),t.p.resolve(r)}catch(e){n=e,t.p.reject(n)}else t.p.resolve(e)},x=function(t,e){var n,r;if("function"==typeof t.n)try{r=t.n.call(g,e),t.p.resolve(r)}catch(e){n=e,t.p.reject(n)}else t.p.reject(e)},d=function(){function t(t){t&&t(function(t){return function(e){return t.resolve(e)}}(this),function(t){return function(e){return t.reject(e)}}(this))}return t.prototype.resolve=function(t){var e,n,r,o;if(this.state===y){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));if(t&&("function"==typeof t||"object"==typeof t))try{if(r=!0,"function"==typeof(o=t.then))return void o.call(t,function(t){return function(e){r&&(r&&(r=!1),t.resolve(e))}}(this),function(t){return function(e){r&&(r=!1,t.reject(e))}}(this))}catch(t){return n=t,void(r&&this.reject(n))}this.state=v,this.v=t,(e=this.c)&&w(function(n){return function(){var n,r,o;for(r=0,o=e.length;r<o;r++)n=e[r],T(n,t)}}())}},t.prototype.reject=function(e){var n;this.state===y&&(this.state=m,this.v=e,(n=this.c)?w(function(){var t,r,o;for(r=0,o=n.length;r<o;r++)t=n[r],x(t,e)}):t.suppressUncaughtRejectionError||"undefined"==typeof console||console.log("Broken Promise, please catch rejections: ",e,e?e.stack:null))},t.prototype.then=function(e,n){var r,o,u,i;return u=new t,o={y:e,n:n,p:u},this.state===y?this.c?this.c.push(o):this.c=[o]:(i=this.state,r=this.v,w(function(){i===v?T(o,r):x(o,r)})),u},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){return this.then(t,t)},t.prototype.timeout=function(e,n){return n=n||"timeout",new t(function(t){return function(r,o){setTimeout(function(){return o(Error(n))},e),t.then(function(t){r(t)},function(t){o(t)})}}(this))},t.prototype.callback=function(t){return"function"==typeof t&&(this.then(function(e){return t(null,e)}),this.catch(function(e){return t(e,null)})),this},t}();var b=d,j=function(t){var e;return e=new b,e.resolve(t),e},_=function(t){var e;return e=new b,e.reject(t),e},k=function(t){var e,n,r,o,u,i,s,c;for(s=[],u=0,c=new b,i=function(e,n){e&&"function"==typeof e.then||(e=j(e)),e.then(function(e){s[n]=e,++u===t.length&&c.resolve(s)},function(t){c.reject(t)})},e=n=0,r=t.length;n<r;e=++n)o=t[e],i(o,e);return t.length||c.resolve(s),c},C=function(t){return new b(function(e,n){return t.then(function(t){return e(new h({state:"fulfilled",value:t}))}).catch(function(t){return e(new h({state:"rejected",reason:t}))})})},E=function(t){return k(t.map(C))};b.all=k,b.reflect=C,b.reject=_,b.resolve=j,b.settle=E,b.soon=w;var O,R,U,S,I,N,A=[].slice;O=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,N=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)},I=function(){var t,e,n,r,o,u,i,s,c,l;try{if(!Object.assign)return!1;if(s=new String("abc"),s[5]="de","5"===Object.getOwnPropertyNames(s)[0])return!1;for(c={},t=e=0;e<=9;t=++e)c["_"+String.fromCharCode(t)]=t;if(u=Object.getOwnPropertyNames(c).map(function(t){return c[t]}),"0123456789"!==u.join(""))return!1;for(l={},i="abcdefghijklmnopqrst".split(""),n=0,r=i.length;n<r;n++)o=i[n],l[o]=o;return"abcdefghijklmnopqrst"===Object.keys(Object.assign({},l)).join("")}catch(t){return t,!1}};var H,L,P,q=U=function(){return I()?Object.assign:function(){var t,e,n,r,o,u,i,s,c,l,a,p;for(a=arguments[0],c=2<=arguments.length?A.call(arguments,1):[],p=N(a),e=0,o=c.length;e<o;e++){s=c[e],t=Object(s);for(r in t)R.call(t,r)&&(p[r]=t[r]);if(O)for(i=O(t),n=0,u=i.length;n<u;n++)l=i[n],S.call(t,l)&&(p[l]=t[l])}return p}}();P=function(t){return t.replace(/^\s*|\s*$/g,"")},H=function(t){return"[object Array]"===Object.prototype.toString.call(t)};var B,F,$=L=function(t){var e,n,r,o,u,i,s,c;if(!t)return{};for(i={},u=P(t).split("\n"),e=0,o=u.length;e<o;e++)return s=u[e],n=s.indexOf(":"),r=P(s.slice(0,n)).toLowerCase(),c=P(s.slice(n+1)),void(void 0===i[r]?i[r]=c:H(i[r])?i[r].push(c):i[r]=[i[r],c]);return i};F={method:"GET",headers:{},data:null,username:null,password:null,async:!0},B=function(){function t(){}return t.DEFAULT_CONTENT_TYPE="application/x-www-form-urlencoded; charset=UTF-8",t.Promise=b,t.prototype.send=function(t){return null==t&&(t={}),t=q({},F,t),new b(function(e){return function(n,r){var o,u,i,s,c;if(!XMLHttpRequest)return void e._handleError("browser",r,null,"browser doesn't support XMLHttpRequest");if("string"!=typeof t.url||0===t.url.length)return void e._handleError("url",r,null,"URL is a required parameter");e._xhr=c=new XMLHttpRequest,c.onload=function(){var t;e._detachWindowUnload();try{t=e._getResponseText()}catch(t){return void e._handleError("parse",r,null,"invalid JSON response")}return n({url:e._getResponseUrl(),headers:e._getHeaders(),responseText:t,status:c.status,statusText:c.statusText,xhr:c})},c.onerror=function(){return e._handleError("error",r)},c.ontimeout=function(){return e._handleError("timeout",r)},c.onabort=function(){return e._handleError("abort",r)},e._attachWindowUnload(),c.open(t.method,t.url,t.async,t.username,t.password),null==t.data||t.headers["Content-Type"]||(t.headers["Content-Type"]=e.constructor.DEFAULT_CONTENT_TYPE),i=t.headers;for(u in i)s=i[u],c.setRequestHeader(u,s);try{return c.send(t.data)}catch(t){return o=t,e._handleError("send",r,null,o.toString())}}}(this))},t.prototype.getXHR=function(){return this._xhr},t.prototype._attachWindowUnload=function(){if(this._unloadHandler=this._handleWindowUnload.bind(this),window.attachEvent)return window.attachEvent("onunload",this._unloadHandler)},t.prototype._detachWindowUnload=function(){if(window.detachEvent)return window.detachEvent("onunload",this._unloadHandler)},t.prototype._getHeaders=function(){return $(this._xhr.getAllResponseHeaders())},t.prototype._getResponseText=function(){var t;switch(t="string"==typeof this._xhr.responseText?this._xhr.responseText:"",this._xhr.getResponseHeader("Content-Type")){case"application/json":case"text/javascript":t=JSON.parse(t+"")}return t},t.prototype._getResponseUrl=function(){return null!=this._xhr.responseURL?this._xhr.responseURL:/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())?this._xhr.getResponseHeader("X-Request-URL"):""},t.prototype._handleError=function(t,e,n,r){return this._detachWindowUnload(),e({reason:t,status:n||this._xhr.status,statusText:r||this._xhr.statusText,xhr:this._xhr})},t.prototype._handleWindowUnload=function(){return this._xhr.abort()},t}();var z,J,M,W,D=B;J=Object.prototype,M=J.hasOwnProperty,W=J.toString,"function"==typeof Symbol&&Symbol.prototype.valueOf;var X,G=function(t){return!!t&&!Y(t)&&M.call(t,"length")&&isFinite(t.length)&&Z(t.length)&&t.length>=0},K=Array.isArray||function(t){return"[object Array]"===W.call(t)},Y=function(t){return"[object Boolean]"===W.call(t)},Z=(z=function(t){var e;return"undefined"!=typeof window&&t===window.alert||("[object Function]"===(e=W.call(t))||"[object GeneratorFunction]"===e||"[object AsyncFunction]"===e)},function(t){return"[object Number]"===W.call(t)}),Q=function(t){return"[object Object]"===W.call(t)};X=class t{contructor(t={}){this.defaults=t}api(t,e,n){var r,o,u,i,s,c,l,a,p,f;if("undefined"!=typeof document){if(arguments.length>1){n=q({path:"/"},this.defaults,n),Z(n.expires)&&(i=new Date,i.setMilliseconds(i.getMilliseconds()+864e5*n.expires),n.expires=i),n.expires=n.expires?n.expires.toUTCString():"";try{p=JSON.stringify(e),/^[\{\[]/.test(p)&&(e=p)}catch(t){t}e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),f="";for(c in n)(r=n[c])&&(f+="; "+c,!0!==r&&(f+="="+r));return document.cookie=t+"="+e+f}for(t||(p={}),u=document.cookie?document.cookie.split("; "):[],a=/(%[0-9A-Z]{2})+/g,s=0;s<u.length;){l=u[s].split("="),o=l.slice(1).join("="),'"'===o.charAt(0)&&(o=o.slice(1,-1));try{if(c=l[0].replace(a,decodeURIComponent),o=o.replace(a,decodeURIComponent),t===c){p=o;break}t||(p[c]=o)}catch(t){t}}return p}}get(t){return this.api.get(t)}getJSON(t){try{return JSON.parse(this.api.get(t))}catch(t){return t,{}}}set(t,e,n){return this.api(t,e,n)}remove(t,e){return this.api(t,"",q(e,{expires:-1}))}};var V,tt=X,et=new tt,nt=[].slice;V=function(){function t(t){var e,n;null==t&&(t={}),this.opts={debug:!1,endpoint:"https://api.hanzo.io",session:{name:"hzo",expires:6048e5}};for(e in t)n=t[e],this.opts[e]=n}return t.prototype.getKey=function(){return this.opts.key},t.prototype.setKey=function(t){return this.opts.key=t},t.prototype.getCustomerToken=function(){var t;return null!=(t=et.getJSON(this.opts.session.name))&&null!=t.customerToken&&(this.customerToken=t.customerToken),this.customerToken},t.prototype.setCustomerToken=function(t){return et.set(this.opts.session.name,{customerToken:t},{expires:this.opts.session.expires}),this.customerToken=t},t.prototype.deleteCustomerToken=function(){return et.set(this.opts.session.name,{customerToken:null},{expires:this.opts.session.expires}),this.customerToken=null},t.prototype.url=function(t,e,r){return n(t)&&(t=t.call(this,e)),l(this.opts.endpoint+t,{token:r})},t.prototype.log=function(){var t;if(t=1<=arguments.length?nt.call(arguments,0):[],t.unshift("hanzo.js>"),this.opts.debug&&"undefined"!=typeof console&&null!==console)return console.log.apply(console,t)},t}();var rt,ot=V,ut=function(t,e){function n(){this.constructor=t}for(var r in e)it.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},it={}.hasOwnProperty;rt=function(t){function e(t){if(!(this instanceof e))return new e(t);e.__super__.constructor.call(this,t),this.getCustomerToken()}return ut(e,t),e.prototype.request=function(t,e,n){var r;return null==e&&(e={}),null==n&&(n=this.getKey()),r={url:this.url(t.url,e,n),method:t.method},"GET"!==t.method&&(r.headers={"Content-Type":"application/json"}),"GET"===t.method?r.url=l(r.url,e):r.data=JSON.stringify(e),this.log("request",{key:n,opts:r}),(new D).send(r).then(function(t){return function(e){return t.log("response",e),e.data=e.responseText,e}}(this)).catch(function(t){return function(n){var r,o;try{n.data=null!=(o=n.responseText)?o:JSON.parse(n.xhr.responseText)}catch(t){r=t}throw r=s(e,n,r),t.log("response",n),t.log("error",r),r}}(this))},e}(ot);var st,ct,lt,at,pt,ft,ht,dt,vt=rt,yt=st=function(t){return function(e){var r;return r=n(t)?t(e):t,null!=this.storeId?"/store/"+this.storeId+r:r}},mt=function(t){switch(t){case"coupon":return st(function(t){var e;return"/coupon/"+(null!=(e=t.code)?e:t)});case"collection":return st(function(t){var e;return"/collection/"+(null!=(e=t.slug)?e:t)});case"product":return st(function(t){var e,n;return"/product/"+(null!=(e=null!=(n=t.id)?n:t.slug)?e:t)});case"variant":return st(function(t){var e,n;return"/variant/"+(null!=(e=null!=(n=t.id)?n:t.sku)?e:t)});case"site":return function(t){var e,n;return"/site/"+(null!=(e=null!=(n=t.id)?n:t.name)?e:t)};default:return function(e){var n;return"/"+t+"/"+(null!=(n=e.id)?n:e)}}};for(lt=function(t){var e;return e="/"+t,{list:{url:e,method:u,expects:r},get:{url:mt(t),method:u,expects:r}}},ct={account:{get:{url:"/account",method:u,expects:r,useCustomerToken:!0},update:{url:"/account",method:"PATCH",expects:r,useCustomerToken:!0},exists:{url:function(t){var e,n,r;return"/account/exists/"+(null!=(e=null!=(n=null!=(r=t.email)?r:t.username)?n:t.id)?e:t)},method:u,expects:r,process:function(t){return t.data.exists}},create:{url:"/account/create",method:i,expects:o},enable:{url:function(t){var e;return"/account/enable/"+(null!=(e=t.tokenId)?e:t)},method:i,expects:r},login:{url:"/account/login",method:i,expects:r,process:function(t){return this.setCustomerToken(t.data.token),t}},logout:function(){return this.deleteCustomerToken()},reset:{url:"/account/reset",method:i,expects:r,useCustomerToken:!0},updateOrder:{url:function(t){var e,n;return"/account/order/"+(null!=(e=null!=(n=t.orderId)?n:t.id)?e:t)},method:"PATCH",expects:r,useCustomerToken:!0},confirm:{url:function(t){var e;return"/account/confirm/"+(null!=(e=t.tokenId)?e:t)},method:i,expects:r,useCustomerToken:!0}},cart:{create:{url:"/cart",method:i,expects:o},update:{url:function(t){var e;return"/cart/"+(null!=(e=t.id)?e:t)},method:"PATCH",expects:r},discard:{url:function(t){var e;return"/cart/"+(null!=(e=t.id)?e:t)+"/discard"},method:i,expects:r},set:{url:function(t){var e;return"/cart/"+(null!=(e=t.id)?e:t)+"/set"},method:i,expects:r}},review:{create:{url:"/review",method:i,expects:o},get:{url:function(t){var e;return"/review/"+(null!=(e=t.id)?e:t)},method:u,expects:r}},checkout:{authorize:{url:yt("/checkout/authorize"),method:i,expects:r},capture:{url:yt(function(t){var e;return"/checkout/capture/"+(null!=(e=t.orderId)?e:t)}),method:i,expects:r},charge:{url:yt("/checkout/charge"),method:i,expects:r},paypal:{url:yt("/checkout/paypal"),method:i,expects:r}},referrer:{create:{url:"/referrer",method:i,expects:o},get:{url:function(t){var e;return"/referrer/"+(null!=(e=t.id)?e:t)},method:u,expects:r}}},dt=["collection","coupon","product","variant"],at=function(t){return ct[t]=lt(t)},pt=0,ft=dt.length;pt<ft;pt++)ht=dt[pt],at(ht);var gt,xt=ct;f.BLUEPRINTS=xt,f.CLIENT=vt,gt=function(t){return null==t&&(t={}),null==t.client&&(t.client=new vt(t)),null==t.blueprints&&(t.blueprints=xt),new f(t)},gt.Api=f,gt.Client=vt;var Tt=gt;t.default=Tt,t.Api=f,t.Client=vt}(this.Hanzo=this.Hanzo||{});
