(function(e){function t(e,n){if({}.hasOwnProperty.call(t.cache,e))return t.cache[e];if("function"==typeof n)return void t.load(e,n);var r=t.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var o={id:e,require:t,filename:e,exports:{},loaded:!1,parent:null,children:[]},i=e.slice(0,e.lastIndexOf("/")+1);return t.cache[e]=o.exports,r.call(o.exports,o,o.exports,i,e),o.loaded=!0,t.cache[e]=o.exports}t.modules={},t.cache={},t.resolve=function(e){return{}.hasOwnProperty.call(t.modules,e)?t.modules[e]:void 0},t.define=function(e,n){t.modules[e]=n},t.waiting={},t.async=function(e,n){for(t.modules[e]=n;cb=t.waiting[e].shift();)cb(t(e))},t.load=function(e,n){var r=document.createElement("script"),o=document.getElementsByTagName("script")[0],i=t.waiting[e]=t.waiting[e]||[];i.push(n),r.type="text/javascript",r.async=!0,r.src=e,o.parentNode.insertBefore(r,o)},t.define("./api",function(e,n,r,o){var i,s,u,c,a,l;a=t("./utils"),s=a.isFunction,u=a.isString,c=a.newError,l=a.statusOk,e.exports=i=function(){function e(t){var n,r,o,i,s,u,c;if(null==t&&(t={}),!(this instanceof e))return new e(t);i=t.endpoint,o=t.debug,u=t.key,r=t.client,n=t.blueprints,this.debug=o,null==n&&(n=this.constructor.BLUEPRINTS),r?this.client=r:this.client=new this.constructor.CLIENT({debug:o,endpoint:i,key:u});for(s in n)c=n[s],this.addBlueprints(s,c)}return e.BLUEPRINTS={},e.CLIENT=function(){},e.prototype.addBlueprints=function(e,t){var n,r,o;null==this[e]&&(this[e]={}),r=function(t){return function(n,r){var o;return s(r)?t[e][n]=function(){return r.apply(t,arguments)}:(null==r.expects&&(r.expects=l),null==r.method&&(r.method="POST"),o=function(e,n){return t.client.request(r,e).then(function(n){var o,i;if(null!=(null!=(o=n.data)?o.error:void 0))throw c(e,n);if(!r.expects(n))throw console.log(n.toJSON()),c(e,n);return null!=r.process&&r.process.call(t,n),null!=(i=n.data)?i:n.body}).callback(n)},t[e][n]=o)}}(this);for(o in t)n=t[o],r(o,n)},e.prototype.setKey=function(e){return this.client.setKey(e)},e.prototype.setUserKey=function(e){return this.client.setUserKey(e)},e.prototype.deleteUserKey=function(){return this.client.deleteUserKey()},e.prototype.setStore=function(e){return this.storeId=e,this.client.setStore(e)},e}()}),t.define("./utils",function(e,t,n,r){t.isFunction=function(e){return"function"==typeof e},t.isString=function(e){return"string"==typeof e},t.statusOk=function(e){return 200===e.status},t.statusCreated=function(e){return 201===e.status},t.statusNoContent=function(e){return 204===e.status},t.newError=function(e,t){var n,r,o,i,s,u,c;return null==t&&(t={}),r=null!=(o=null!=t&&null!=(i=t.data)&&null!=(s=i.error)?s.message:void 0)?o:"Request failed",n=new Error(r),n.message=r,n.req=e,n.data=t.data,n.responseText=t.data,n.status=t.status,n.type=null!=(u=t.data)&&null!=(c=u.error)?c.type:void 0,n},t.updateQuery=function(e,t,n){var r,o,i;return o=new RegExp("([?&])"+t+"=.*?(&|#|$)(.*)","gi"),o.test(e)?null!=n?e.replace(o,"$1"+t+"="+n+"$2$3"):(r=e.split("#"),e=r[0].replace(o,"$1$3").replace(/(&|\?)$/,""),null!=r[1]&&(e+="#"+r[1]),e):null!=n?(i=-1!==e.indexOf("?")?"&":"?",r=e.split("#"),e=r[0]+i+t+"="+n,null!=r[1]&&(e+="#"+r[1]),e):e}}),t.define("./client/xhr",function(n,r,o,i){var s,u,c,a,l,f,p;s=t("xhr-promise-es6/lib"),s.Promise=t("broken/lib"),c=t("js-cookie/src/js.cookie"),f=t("./utils"),a=f.isFunction,l=f.newError,p=f.updateQuery,n.exports=u=function(){function t(e){return null==e&&(e={}),this instanceof t?(this.key=e.key,this.debug=e.debug,e.endpoint&&this.setEndpoint(e.endpoint),void this.getUserKey()):new t(e)}return t.prototype.debug=!1,t.prototype.endpoint="https://api.crowdstart.com",t.prototype.sessionName="crowdstart-session",t.prototype.setEndpoint=function(e){return this.endpoint=e.replace(/\/$/,"")},t.prototype.setStore=function(e){return this.storeId=e},t.prototype.setKey=function(e){return this.key=e},t.prototype.getKey=function(){return this.userKey||this.key||this.constructor.KEY},t.prototype.getUserKey=function(){var t,n;return null!=e.document&&null!=(t=c.getJSON(this.sessionName),n=t.userKey,t)&&(this.userKey=n),this.userKey},t.prototype.setUserKey=function(t){return null!=e.document&&c.set(this.sessionName,{userKey:t},{expires:6048e5}),this.userKey=t},t.prototype.deleteUserKey=function(){return null!=e.document&&c.set(this.sessionName,{userKey:null},{expires:6048e5}),this.userKey},t.prototype.getUrl=function(e,t,n){return a(e)&&(e=e.call(this,t)),p(""+this.endpoint+e,"token",n)},t.prototype.request=function(e,t,n){var r;return null==n&&(n=this.getKey()),r={url:this.getUrl(e.url,t,n),method:e.method,data:JSON.stringify(t)},this.debug&&(console.log("--REQUEST--"),console.log(r)),(new s).send(r).then(function(e){return this.debug&&(console.log("--RESPONSE--"),console.log(e)),e.data=e.responseText,e})["catch"](function(e){var n,r,o;try{e.data=null!=(o=e.responseText)?o:JSON.parse(e.xhr.responseText)}catch(r){n=r}throw n=l(t,e),this.debug&&(console.log("--RESPONSE--"),console.log(e),console.log("ERROR:",n)),n})},t}()}),t.define("xhr-promise-es6/lib",function(e,n,r,o){var i,s;i=t("parse-headers/parse-headers"),e.exports=s=function(){function e(){}return e.DEFAULT_CONTENT_TYPE="application/x-www-form-urlencoded; charset=UTF-8",e.Promise=Promise,e.prototype.send=function(e){var t;return null==e&&(e={}),t={method:"GET",data:null,headers:{},async:!0,username:null,password:null},e=Object.assign({},t,e),new this.constructor.Promise(function(t){return function(n,r){var o,i,s,u,c;if(!XMLHttpRequest)return void t._handleError("browser",r,null,"browser doesn't support XMLHttpRequest");if("string"!=typeof e.url||0===e.url.length)return void t._handleError("url",r,null,"URL is a required parameter");t._xhr=c=new XMLHttpRequest,c.onload=function(){var e;t._detachWindowUnload();try{e=t._getResponseText()}catch(o){return void t._handleError("parse",r,null,"invalid JSON response")}return n({url:t._getResponseUrl(),status:c.status,statusText:c.statusText,responseText:e,headers:t._getHeaders(),xhr:c})},c.onerror=function(){return t._handleError("error",r)},c.ontimeout=function(){return t._handleError("timeout",r)},c.onabort=function(){return t._handleError("abort",r)},t._attachWindowUnload(),c.open(e.method,e.url,e.async,e.username,e.password),null==e.data||e.headers["Content-Type"]||(e.headers["Content-Type"]=t.constructor.DEFAULT_CONTENT_TYPE),s=e.headers;for(i in s)u=s[i],c.setRequestHeader(i,u);try{return c.send(e.data)}catch(a){return o=a,t._handleError("send",r,null,o.toString())}}}(this))},e.prototype.getXHR=function(){return this._xhr},e.prototype._attachWindowUnload=function(){return this._unloadHandler=this._handleWindowUnload.bind(this),window.attachEvent?window.attachEvent("onunload",this._unloadHandler):void 0},e.prototype._detachWindowUnload=function(){return window.detachEvent?window.detachEvent("onunload",this._unloadHandler):void 0},e.prototype._getHeaders=function(){return i(this._xhr.getAllResponseHeaders())},e.prototype._getResponseText=function(){var e;switch(e="string"==typeof this._xhr.responseText?this._xhr.responseText:"",this._xhr.getResponseHeader("Content-Type")){case"application/json":case"text/javascript":e=JSON.parse(e+"")}return e},e.prototype._getResponseUrl=function(){return null!=this._xhr.responseURL?this._xhr.responseURL:/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())?this._xhr.getResponseHeader("X-Request-URL"):""},e.prototype._handleError=function(e,t,n,r){return this._detachWindowUnload(),t({reason:e,status:n||this._xhr.status,statusText:r||this._xhr.statusText,xhr:this._xhr})},e.prototype._handleWindowUnload=function(){return this._xhr.abort()},e}()}),t.define("parse-headers/parse-headers",function(e,n,r,o){var i=t("trim"),s=t("for-each"),u=function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports=function(e){if(!e)return{};var t={};return s(i(e).split("\n"),function(e){var n=e.indexOf(":"),r=i(e.slice(0,n)).toLowerCase(),o=i(e.slice(n+1));"undefined"==typeof t[r]?t[r]=o:u(t[r])?t[r].push(o):t[r]=[t[r],o]}),t}}),t.define("trim",function(e,t,n,r){function o(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=o,t.left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}),t.define("for-each",function(e,n,r,o){function i(e,t,n){if(!a(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===l.call(e)?s(e,t,n):"string"==typeof e?u(e,t,n):c(e,t,n)}function s(e,t,n){for(var r=0,o=e.length;o>r;r++)f.call(e,r)&&t.call(n,e[r],r,e)}function u(e,t,n){for(var r=0,o=e.length;o>r;r++)t.call(n,e.charAt(r),r,e)}function c(e,t,n){for(var r in e)f.call(e,r)&&t.call(n,e[r],r,e)}var a=t("is-function");e.exports=i;var l=Object.prototype.toString,f=Object.prototype.hasOwnProperty}),t.define("is-function",function(e,t,n,r){function o(e){var t=i.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}e.exports=o;var i=Object.prototype.toString}),t.define("broken/lib",function(e,n,r,o){var i,s;i=t("zousan/zousan-min"),i.suppressUncaughtRejectionError=!0,s=function(){function e(e){this.state=e.state,this.value=e.value,this.reason=e.reason}return e.prototype.isFulfilled=function(){return"fulfilled"===this.state},e.prototype.isRejected=function(){return"rejected"===this.state},e}(),i.reflect=function(e){return new i(function(t,n){return e.then(function(e){return t(new s({state:"fulfilled",value:e}))})["catch"](function(e){return t(new s({state:"rejected",reason:e}))})})},i.settle=function(e){return i.all(e.map(i.reflect))},i.prototype.callback=function(e){return"function"==typeof e&&(this.then(function(t){return e(null,t)}),this["catch"](function(t){return e(t,null)})),this},e.exports=i}),t.define("zousan/zousan-min",function(t,n,r,o){!function(e){"use strict";function n(e){if(e){var t=this;e(function(e){t.resolve(e)},function(e){t.reject(e)})}}function r(e,t){if("function"==typeof e.y)try{var n=e.y.call(s,t);e.p.resolve(n)}catch(r){e.p.reject(r)}else e.p.resolve(t)}function o(e,t){if("function"==typeof e.n)try{var n=e.n.call(s,t);e.p.resolve(n)}catch(r){e.p.reject(r)}else e.p.reject(t)}var i,s,u="fulfilled",c="rejected",a="undefined",l=function(){function e(){for(;t.length-n;)t[n](),n++,n>1024&&(t.splice(0,n),n=0)}var t=[],n=0,r=function(){if(typeof MutationObserver!==a){var t=document.createElement("div"),n=new MutationObserver(e);return n.observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}return typeof setImmediate!==a?function(){setImmediate(e)}:function(){setTimeout(e,0)}}();return function(e){t.push(e),t.length-n==1&&r()}}();n.prototype={resolve:function(e){if(this.state===i){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var n=!0,o=e.then;if("function"==typeof o)return void o.call(e,function(e){n&&(n=!1,t.resolve(e))},function(e){n&&(n=!1,t.reject(e))})}catch(s){return void(n&&this.reject(s))}this.state=u,this.v=e,t.c&&l(function(){for(var n=0,o=t.c.length;o>n;n++)r(t.c[n],e)})}},reject:function(e){if(this.state===i){this.state=c,this.v=e;var t=this.c;t?l(function(){for(var n=0,r=t.length;r>n;n++)o(t[n],e)}):n.suppressUncaughtRejectionError||console.log("You upset Zousan. Please catch rejections: ",e,e.stack)}},then:function(e,t){var s=new n,c={y:e,n:t,p:s};if(this.state===i)this.c?this.c.push(c):this.c=[c];else{var a=this.state,f=this.v;l(function(){a===u?r(c,f):o(c,f)})}return s},"catch":function(e){return this.then(null,e)},"finally":function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var r=this;return new n(function(n,o){setTimeout(function(){o(Error(t))},e),r.then(function(e){n(e)},function(e){o(e)})})}},n.resolve=function(e){var t=new n;return t.resolve(e),t},n.reject=function(e){var t=new n;return t.reject(e),t},n.all=function(e){function t(t,s){"function"!=typeof t.then&&(t=n.resolve(t)),t.then(function(t){r[s]=t,o++,o==e.length&&i.resolve(r)},function(e){i.reject(e)})}for(var r=[],o=0,i=new n,s=0;s<e.length;s++)t(e[s],s);return e.length||i.resolve(r),i},typeof t!=a&&t.exports&&(t.exports=n),e.Zousan=n,n.soon=l}("undefined"!=typeof e?e:this)}),t.define("js-cookie/src/js.cookie",function(e,t,n,r){!function(n){if("function"==typeof define&&define.amd)define(n);else if("object"==typeof t)e.exports=n();else{var r=window.Cookies,o=window.Cookies=n();o.noConflict=function(){return window.Cookies=r,o}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(n){function r(t,o,i){var s;if(arguments.length>1){if(i=e({path:"/"},r.defaults,i),"number"==typeof i.expires){var u=new Date;u.setMilliseconds(u.getMilliseconds()+864e5*i.expires),i.expires=u}try{s=JSON.stringify(o),/^[\{\[]/.test(s)&&(o=s)}catch(c){}return o=encodeURIComponent(String(o)),o=o.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",o,i.expires&&"; expires="+i.expires.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure?"; secure":""].join("")}t||(s={});for(var a=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,f=0;f<a.length;f++){var p=a[f].split("="),d=p[0].replace(l,decodeURIComponent),h=p.slice(1).join("=");'"'===h.charAt(0)&&(h=h.slice(1,-1));try{if(h=n&&n(h,d)||h.replace(l,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(c){}if(t===d){s=h;break}t||(s[d]=h)}catch(c){}}return s}return r.get=r.set=r,r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,n){r(t,"",e(n,{expires:-1}))},r.withConverter=t,r}return t()})}),t.define("./blueprints/browser",function(e,n,r,o){var i,s,u,c,a,l,f,p,d,h,y,v,g,m,w;for(h=t("./utils"),l=h.isFunction,v=h.statusCreated,g=h.statusNoContent,m=h.statusOk,y=t("./blueprints/url"),s=y.byId,w=y.storePrefixed,u=function(e){var t;return t="/"+e,{list:{url:t,method:"GET"},get:{url:s(e),method:"GET"}}},i={account:{get:{url:"/account",method:"GET"},update:{url:"/account",method:"PATCH"},exists:{url:function(e){var t,n,r;return"/account/exists/"+(null!=(t=null!=(n=null!=(r=e.email)?r:e.username)?n:e.id)?t:e)},method:"GET",process:function(e){return e.data.exists}},create:{url:"/account/create",expects:v(x)},enable:{url:function(e){var t;return"/account/enable/"+(null!=(t=e.tokenId)?t:e)},method:"GET"},login:{url:"/account/login",process:function(e){return this.setUserKey(e.data.token),e}},logout:function(){return this.deleteUserKey()},reset:{url:"/account/reset/#{x.tokenId ? x}"},confirm:{url:function(e){var t;return"/account/confirm/"+(null!=(t=e.tokenId)?t:e)}}},checkout:{authorize:{url:w("/authorize")},capture:{url:w(function(e){var t;return"/capture/"+(null!=(t=e.orderId)?t:e)})},charge:{url:w("/charge")},paypal:{url:w("/paypal/pay")}},referrer:{create:{url:"/referrer",expects:v}}},d=["coupon","collection","product","variant"],c=function(e){return i[e]=u(e)},a=0,f=d.length;f>a;a++)p=d[a],c(p);e.exports=i}),t.define("./blueprints/url",function(e,n,r,o){var i,s;i=t("./utils").isFunction,n.storePrefixed=s=function(e){return function(t){var n;return n=i(e)?e(t):e,null!=this.storeId?"/store/"+this.storeId+n:n}},n.byId=function(e){switch(e){case"coupon":return s(function(e){var t;return"/coupon/"+(null!=(t=e.code)?t:e)});case"collection":return s(function(e){var t;return"/collection/"+(null!=(t=e.slug)?t:e)});case"product":return s(function(e){var t,n;return"/product/"+(null!=(t=null!=(n=e.id)?n:e.slug)?t:e)});case"variant":return s(function(e){var t,n;return"/variant/"+(null!=(t=null!=(n=e.id)?n:e.sku)?t:e)});default:return function(t){var n;return"/"+e+"/"+(null!=(n=t.id)?n:t)}}}}),t.define("./browser",function(n,r,o,i){var s,u;null==e.Crowdstart&&(e.Crowdstart={}),s=t("./api"),u=t("./client/xhr"),s.CLIENT=u,s.BLUEPRINTS=t("./blueprints/browser"),Crowdstart.Api=s,Crowdstart.Client=u,n.exports=Crowdstart}),t("./browser")}).call(this,this);
