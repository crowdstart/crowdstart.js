(function(e){function t(e,n){if({}.hasOwnProperty.call(t.cache,e))return t.cache[e];if("function"==typeof n)return void t.load(e,n);var r=t.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var o={id:e,require:t,filename:e,exports:{},loaded:!1,parent:null,children:[]},i=e.slice(0,e.lastIndexOf("/")+1);return t.cache[e]=o.exports,r.call(o.exports,o,o.exports,i,e),o.loaded=!0,t.cache[e]=o.exports}t.modules={},t.cache={},t.resolve=function(e){return{}.hasOwnProperty.call(t.modules,e)?t.modules[e]:void 0},t.define=function(e,n){t.modules[e]=n},t.waiting={},t.async=function(e,n){for(t.modules[e]=n;cb=t.waiting[e].shift();)cb(t(e))},t.load=function(e,n){var r=document.createElement("script"),o=document.getElementsByTagName("script")[0],i=t.waiting[e]=t.waiting[e]||[];i.push(n),r.type="text/javascript",r.async=!0,r.src=e,o.parentNode.insertBefore(r,o)},t.define("./api",function(e,n,r,o){var i,u,s,c,a,l;u=t("cookies-js/dist/cookies"),a=t("./utils"),s=a.isFunction,c=a.newError,l=a.statusOk,e.exports=i=function(){function e(n){var r,o,i,u,s,c,a;if(null==n&&(n={}),!(this instanceof e))return function(e,t,n){n.prototype=e.prototype;var r=new n,o=e.apply(r,t);return Object(o)===o?o:r}(e,arguments,function(){});u=n.endpoint,i=n.debug,c=n.key,o=n.client,r=n.blueprints,this.debug=i,null==r&&(r=t("./blueprints/browser")),o?this.client=o:this.client=new(t("./client"))({debug:i,endpoint:u,key:c});for(s in r)a=r[s],this.addBlueprints(s,a)}return e.prototype.sessionName="crowdstart-session",e.prototype.addBlueprints=function(e,t){var n,r,o;null==this[e]&&(this[e]={}),o=[];for(r in t)n=t[r],o.push(function(t){return function(n,r){var o,i,u,a;return s(r)?void(t[e][n]=function(){return r.apply(t,arguments)}):(u="string"==typeof r.uri?function(e){return r.uri}:r.uri,o=r.expects,i=r.method,a=r.process,null==o&&(o=l),null==i&&(i="POST"),t[e][n]=function(e,n){var r;return r=u.call(t,e),t.client.request(r,e,i).then(function(n){var r;if(null!=(null!=(r=n.data)?r.error:void 0))throw c(e,n);if(!o(n))throw c(e,n);return null!=a&&a.call(t,n),n}).callback(n)})}}(this)(r,n));return o},e.prototype.setKey=function(e){return this.client.setKey(e)},e.prototype.setUserKey=function(e){return u.set(this.sessionName,e,{expires:604800}),this.client.setUserKey(e)},e.prototype.getUserKey=function(){var e;return null!=(e=u.get(this.sessionName))?e:""},e.prototype.setStore=function(e){return this.storeId=e},e}()}),t.define("cookies-js/dist/cookies",function(e,t,n,r){!function(n,r){"use strict";var o=function(e){if("object"!=typeof e.document)throw new Error("Cookies.js requires a `window` with a `document` object");var t=function(e,n,r){return 1===arguments.length?t.get(e):t.set(e,n,r)};return t._document=e.document,t._cacheKeyPrefix="cookey.",t._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),t.defaults={path:"/",secure:!1},t.get=function(e){t._cachedDocumentCookie!==t._document.cookie&&t._renewCache();var n=t._cache[t._cacheKeyPrefix+e];return n===r?r:decodeURIComponent(n)},t.set=function(e,n,o){return o=t._getExtendedOptions(o),o.expires=t._getExpiresDate(n===r?-1:o.expires),t._document.cookie=t._generateCookieString(e,n,o),t},t.expire=function(e,n){return t.set(e,r,n)},t._getExtendedOptions=function(e){return{path:e&&e.path||t.defaults.path,domain:e&&e.domain||t.defaults.domain,expires:e&&e.expires||t.defaults.expires,secure:e&&e.secure!==r?e.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){if(n=n||new Date,"number"==typeof e?e=e===1/0?t._maxExpireDate:new Date(n.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){e=e.replace(/[^#$&+\^`|]/g,encodeURIComponent),e=e.replace(/\(/g,"%28").replace(/\)/g,"%29"),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),n=n||{};var r=e+"="+t;return r+=n.path?";path="+n.path:"",r+=n.domain?";domain="+n.domain:"",r+=n.expires?";expires="+n.expires.toUTCString():"",r+=n.secure?";secure":""},t._getCacheFromString=function(e){for(var n={},o=e?e.split("; "):[],i=0;i<o.length;i++){var u=t._getKeyValuePairFromCookieString(o[i]);n[t._cacheKeyPrefix+u.key]===r&&(n[t._cacheKeyPrefix+u.key]=u.value)}return n},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");t=0>t?e.length:t;var n,r=e.substr(0,t);try{n=decodeURIComponent(r)}catch(o){console&&"function"==typeof console.error&&console.error('Could not decode cookie with key "'+r+'"',o)}return{key:n,value:e.substr(t+1)}},t._renewCache=function(){t._cache=t._getCacheFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){var e="cookies.js",n="1"===t.set(e,1).get(e);return t.expire(e),n},t.enabled=t._areEnabled(),t},i="object"==typeof n.document?o(n):o;"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof t?("object"==typeof e&&"object"==typeof e.exports&&(t=e.exports=i),t.Cookies=i):n.Cookies=i}("undefined"==typeof window?this:window)}),t.define("./utils",function(e,t,n,r){t.isFunction=function(e){return"function"==typeof e},t.isString=function(e){return"string"==typeof e},t.statusOk=function(e){return 200===e.status},t.statusCreated=function(e){return 201===e.status},t.statusNoContent=function(e){return 204===e.status},t.newError=function(e,t){var n,r,o,i,u,s,c;return r=null!=(o=null!=t&&null!=(i=t.data)&&null!=(u=i.error)?u.message:void 0)?o:"Request failed",n=new Error(r),n.message=r,n.req=e,n.res=t,n.data=t.data,n.responseText=t.data,n.status=t.status,n.type=null!=(s=t.data)&&null!=(c=s.error)?c.type:void 0,n}}),t.define("./blueprints/browser",function(e,n,r,o){var i,u,s,c,a,l,f,p,d,h,y,v,m,g,w;for(h=t("./utils"),l=h.isFunction,v=h.statusCreated,m=h.statusNoContent,g=h.statusOk,y=t("./blueprints/uri"),u=y.byId,w=y.storePrefixed,s=function(e){var t;return t="/"+e,{list:{uri:t,method:"GET"},get:{uri:u(e),method:"GET"}}},i={account:{get:{uri:"/account",method:"GET"},update:{uri:"/account",method:"PATCH"},exists:{uri:function(e){var t,n,r;return"/account/exists/"+(null!=(t=null!=(n=null!=(r=e.email)?r:e.username)?n:e.id)?t:e)},method:"GET",process:function(e){return e.data.exists}},create:{uri:"/account/create"},enable:{uri:function(e){return"/account/create/confirm/"+e.tokenId}},login:{uri:"/account/login",process:function(e){return this.setUserKey(e.data.token),e}},logout:function(){return this.setUserKey("")},reset:{uri:function(e){return"/account/reset?email="+e.email}},confirm:{uri:function(e){return"/account/reset/confirm/"+e.tokenId}}},payment:{authorize:{uri:w("/authorize")},capture:{uri:w(function(e){return"/capture/"+e.orderId})},charge:{uri:w("/charge")},paypal:{uri:w("/paypal/pay")}}},d=["coupon","product","referral","referrer","transaction"],c=function(e){return i[e]=s(e)},a=0,f=d.length;f>a;a++)p=d[a],c(p);e.exports=i}),t.define("./blueprints/uri",function(e,n,r,o){var i,u;i=t("./utils").isFunction,n.storePrefixed=u=function(e){return function(t){var n;return n=i(e)?e(t):e,null!=this.storeId?"/store/"+this.storeId+n:n}},n.byId=function(e){switch(e){case"coupon":return u(function(e){var t;return"/coupon/"+(null!=(t=e.code)?t:e)});case"product":return u(function(e){var t,n;return"/product/"+(null!=(t=null!=(n=e.id)?n:e.slug)?t:e)});default:return function(t){var n;return e+"/"+(null!=(n=t.id)?n:t)}}}}),t.define("./client",function(e,n,r,o){var i,u;u=t("xhr-promise-es6/lib"),u.Promise=t("broken/lib"),e.exports=i=function(){function e(t){var n;return n=null!=t?t:{},this.key=n.key,this.endpoint=n.endpoint,this.debug=n.debug,this instanceof e?void 0:new e(this.key)}return e.prototype.debug=!1,e.prototype.endpoint="https://api.crowdstart.com",e.prototype.setKey=function(e){return this.key=e},e.prototype.setUserKey=function(e){return this.userKey=e},e.prototype.getKey=function(){return this.userKey||this.key},e.prototype.request=function(e,t,n,r){var o;return null==n&&(n="POST"),null==r&&(r=this.getKey()),o={url:this.endpoint.replace(/\/$/,"")+e+"?token="+r,method:n,data:JSON.stringify(t)},this.debug&&console.log("REQUEST HEADER:",o),(new u).send(o).then(function(e){return e.data=e.responseText,e})["catch"](function(e){var n,r,o;try{e.data=null!=(o=e.responseText)?o:JSON.parse(e.xhr.responseText)}catch(r){n=r}throw newError(t,e)})},e}()}),t.define("xhr-promise-es6/lib",function(e,n,r,o){var i,u;i=t("parse-headers/parse-headers"),e.exports=u=function(){function e(){}return e.DEFAULT_CONTENT_TYPE="application/x-www-form-urlencoded; charset=UTF-8",e.Promise=Promise,e.prototype.send=function(e){var t;return null==e&&(e={}),t={method:"GET",data:null,headers:{},async:!0,username:null,password:null},e=Object.assign({},t,e),new this.constructor.Promise(function(t){return function(n,r){var o,i,u,s,c;if(!XMLHttpRequest)return void t._handleError("browser",r,null,"browser doesn't support XMLHttpRequest");if("string"!=typeof e.url||0===e.url.length)return void t._handleError("url",r,null,"URL is a required parameter");t._xhr=c=new XMLHttpRequest,c.onload=function(){var e;t._detachWindowUnload();try{e=t._getResponseText()}catch(o){return void t._handleError("parse",r,null,"invalid JSON response")}return n({url:t._getResponseUrl(),status:c.status,statusText:c.statusText,responseText:e,headers:t._getHeaders(),xhr:c})},c.onerror=function(){return t._handleError("error",r)},c.ontimeout=function(){return t._handleError("timeout",r)},c.onabort=function(){return t._handleError("abort",r)},t._attachWindowUnload(),c.open(e.method,e.url,e.async,e.username,e.password),null==e.data||e.headers["Content-Type"]||(e.headers["Content-Type"]=t.constructor.DEFAULT_CONTENT_TYPE),u=e.headers;for(i in u)s=u[i],c.setRequestHeader(i,s);try{return c.send(e.data)}catch(a){return o=a,t._handleError("send",r,null,o.toString())}}}(this))},e.prototype.getXHR=function(){return this._xhr},e.prototype._attachWindowUnload=function(){return this._unloadHandler=this._handleWindowUnload.bind(this),window.attachEvent?window.attachEvent("onunload",this._unloadHandler):void 0},e.prototype._detachWindowUnload=function(){return window.detachEvent?window.detachEvent("onunload",this._unloadHandler):void 0},e.prototype._getHeaders=function(){return i(this._xhr.getAllResponseHeaders())},e.prototype._getResponseText=function(){var e;switch(e="string"==typeof this._xhr.responseText?this._xhr.responseText:"",this._xhr.getResponseHeader("Content-Type")){case"application/json":case"text/javascript":e=JSON.parse(e+"")}return e},e.prototype._getResponseUrl=function(){return null!=this._xhr.responseURL?this._xhr.responseURL:/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())?this._xhr.getResponseHeader("X-Request-URL"):""},e.prototype._handleError=function(e,t,n,r){return this._detachWindowUnload(),t({reason:e,status:n||this._xhr.status,statusText:r||this._xhr.statusText,xhr:this._xhr})},e.prototype._handleWindowUnload=function(){return this._xhr.abort()},e}()}),t.define("parse-headers/parse-headers",function(e,n,r,o){var i=t("trim"),u=t("for-each"),s=function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports=function(e){if(!e)return{};var t={};return u(i(e).split("\n"),function(e){var n=e.indexOf(":"),r=i(e.slice(0,n)).toLowerCase(),o=i(e.slice(n+1));"undefined"==typeof t[r]?t[r]=o:s(t[r])?t[r].push(o):t[r]=[t[r],o]}),t}}),t.define("trim",function(e,t,n,r){function o(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=o,t.left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}),t.define("for-each",function(e,n,r,o){function i(e,t,n){if(!a(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===l.call(e)?u(e,t,n):"string"==typeof e?s(e,t,n):c(e,t,n)}function u(e,t,n){for(var r=0,o=e.length;o>r;r++)f.call(e,r)&&t.call(n,e[r],r,e)}function s(e,t,n){for(var r=0,o=e.length;o>r;r++)t.call(n,e.charAt(r),r,e)}function c(e,t,n){for(var r in e)f.call(e,r)&&t.call(n,e[r],r,e)}var a=t("is-function");e.exports=i;var l=Object.prototype.toString,f=Object.prototype.hasOwnProperty}),t.define("is-function",function(e,t,n,r){function o(e){var t=i.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}e.exports=o;var i=Object.prototype.toString}),t.define("broken/lib",function(e,n,r,o){var i,u;i=t("zousan/zousan-min"),i.suppressUncaughtRejectionError=!0,u=function(){function e(e){this.state=e.state,this.value=e.value,this.reason=e.reason}return e.prototype.isFulfilled=function(){return"fulfilled"===this.state},e.prototype.isRejected=function(){return"rejected"===this.state},e}(),i.reflect=function(e){return new i(function(t,n){return e.then(function(e){return t(new u({state:"fulfilled",value:e}))})["catch"](function(e){return t(new u({state:"rejected",reason:e}))})})},i.settle=function(e){return i.all(e.map(i.reflect))},i.prototype.callback=function(e){return"function"==typeof e&&(this.then(function(t){return e(null,t)}),this["catch"](function(t){return e(t,null)})),this},e.exports=i}),t.define("zousan/zousan-min",function(t,n,r,o){!function(e){"use strict";function n(e){if(e){var t=this;e(function(e){t.resolve(e)},function(e){t.reject(e)})}}function r(e,t){if("function"==typeof e.y)try{var n=e.y.call(u,t);e.p.resolve(n)}catch(r){e.p.reject(r)}else e.p.resolve(t)}function o(e,t){if("function"==typeof e.n)try{var n=e.n.call(u,t);e.p.resolve(n)}catch(r){e.p.reject(r)}else e.p.reject(t)}var i,u,s="fulfilled",c="rejected",a="undefined",l=function(){function e(){for(;t.length-n;)t[n](),n++,n>1024&&(t.splice(0,n),n=0)}var t=[],n=0,r=function(){if(typeof MutationObserver!==a){var t=document.createElement("div"),n=new MutationObserver(e);return n.observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}return typeof setImmediate!==a?function(){setImmediate(e)}:function(){setTimeout(e,0)}}();return function(e){t.push(e),t.length-n==1&&r()}}();n.prototype={resolve:function(e){if(this.state===i){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var n=!0,o=e.then;if("function"==typeof o)return void o.call(e,function(e){n&&(n=!1,t.resolve(e))},function(e){n&&(n=!1,t.reject(e))})}catch(u){return void(n&&this.reject(u))}this.state=s,this.v=e,t.c&&l(function(){for(var n=0,o=t.c.length;o>n;n++)r(t.c[n],e)})}},reject:function(e){if(this.state===i){this.state=c,this.v=e;var t=this.c;t?l(function(){for(var n=0,r=t.length;r>n;n++)o(t[n],e)}):n.suppressUncaughtRejectionError||console.log("You upset Zousan. Please catch rejections: ",e,e.stack)}},then:function(e,t){var u=new n,c={y:e,n:t,p:u};if(this.state===i)this.c?this.c.push(c):this.c=[c];else{var a=this.state,f=this.v;l(function(){a===s?r(c,f):o(c,f)})}return u},"catch":function(e){return this.then(null,e)},"finally":function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var r=this;return new n(function(n,o){setTimeout(function(){o(Error(t))},e),r.then(function(e){n(e)},function(e){o(e)})})}},n.resolve=function(e){var t=new n;return t.resolve(e),t},n.reject=function(e){var t=new n;return t.reject(e),t},n.all=function(e){function t(t,u){"function"!=typeof t.then&&(t=n.resolve(t)),t.then(function(t){r[u]=t,o++,o==e.length&&i.resolve(r)},function(e){i.reject(e)})}for(var r=[],o=0,i=new n,u=0;u<e.length;u++)t(e[u],u);return e.length||i.resolve(r),i},typeof t!=a&&t.exports&&(t.exports=n),e.Zousan=n,n.soon=l}("undefined"!=typeof e?e:this)}),t.define("./index",function(n,r,o,i){null==e.Crowdstart&&(e.Crowdstart={}),Crowdstart.Api=t("./api"),Crowdstart.Client=t("./client"),n.exports=Crowdstart}),t("./index")}).call(this,this);
