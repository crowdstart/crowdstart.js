(function(e){function t(e,n){if({}.hasOwnProperty.call(t.cache,e))return t.cache[e];if("function"==typeof n)return void t.load(e,n);var r=t.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var o={id:e,require:t,filename:e,exports:{},loaded:!1,parent:null,children:[]},i=e.slice(0,e.lastIndexOf("/")+1);return t.cache[e]=o.exports,r.call(o.exports,o,o.exports,i,e),o.loaded=!0,t.cache[e]=o.exports}t.modules={},t.cache={},t.resolve=function(e){return{}.hasOwnProperty.call(t.modules,e)?t.modules[e]:void 0},t.define=function(e,n){t.modules[e]=n},e.require=t,t.define("./client",function(e,n,r,o){var i,u;u=t("xhr-promise-es6/lib"),u.Promise=t("broken/lib"),e.exports=i=function(){function e(e){this.key=e}return e.prototype.debug=!1,e.prototype.endpoint="https://api.crowdstart.com",e.prototype.request=function(e,t,n,r){var o;return null==n&&(n="POST"),null==r&&(r=this.key),o={url:this.endpoint.replace(/\/$/,"")+e+"?token="+r,method:n,data:JSON.stringify(t)},this.debug&&console.log("REQUEST HEADER:",o),(new u).send(o).then(function(e){return e.data=e.responseText,e})["catch"](function(e){throw newError(t,e)})},e}()}),t.define("xhr-promise-es6/lib",function(e,n,r,o){var i,u;i=t("parse-headers/parse-headers"),e.exports=u=function(){function e(){}return e.DEFAULT_CONTENT_TYPE="application/x-www-form-urlencoded; charset=UTF-8",e.prototype.send=function(e){var t;return null==e&&(e={}),t={method:"GET",data:null,headers:{},async:!0,username:null,password:null},e=Object.assign({},t,e),new Promise(function(t){return function(n,r){var o,i,u,s,c;if(!XMLHttpRequest)return void t._handleError("browser",r,null,"browser doesn't support XMLHttpRequest");if("string"!=typeof e.url||0===e.url.length)return void t._handleError("url",r,null,"URL is a required parameter");t._xhr=c=new XMLHttpRequest,c.onload=function(){var e;t._detachWindowUnload();try{e=t._getResponseText()}catch(o){return void t._handleError("parse",r,null,"invalid JSON response")}return n({url:t._getResponseUrl(),status:c.status,statusText:c.statusText,responseText:e,headers:t._getHeaders(),xhr:c})},c.onerror=function(){return t._handleError("error",r)},c.ontimeout=function(){return t._handleError("timeout",r)},c.onabort=function(){return t._handleError("abort",r)},t._attachWindowUnload(),c.open(e.method,e.url,e.async,e.username,e.password),null==e.data||e.headers["Content-Type"]||(e.headers["Content-Type"]=t.constructor.DEFAULT_CONTENT_TYPE),u=e.headers;for(i in u)s=u[i],c.setRequestHeader(i,s);try{return c.send(e.data)}catch(a){return o=a,t._handleError("send",r,null,o.toString())}}}(this))},e.prototype.getXHR=function(){return this._xhr},e.prototype._attachWindowUnload=function(){return this._unloadHandler=this._handleWindowUnload.bind(this),window.attachEvent?window.attachEvent("onunload",this._unloadHandler):void 0},e.prototype._detachWindowUnload=function(){return window.detachEvent?window.detachEvent("onunload",this._unloadHandler):void 0},e.prototype._getHeaders=function(){return i(this._xhr.getAllResponseHeaders())},e.prototype._getResponseText=function(){var e;switch(e="string"==typeof this._xhr.responseText?this._xhr.responseText:"",this._xhr.getResponseHeader("Content-Type")){case"application/json":case"text/javascript":e=JSON.parse(e+"")}return e},e.prototype._getResponseUrl=function(){return null!=this._xhr.responseURL?this._xhr.responseURL:/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())?this._xhr.getResponseHeader("X-Request-URL"):""},e.prototype._handleError=function(e,t,n,r){return this._detachWindowUnload(),t({reason:e,status:n||this._xhr.status,statusText:r||this._xhr.statusText,xhr:this._xhr})},e.prototype._handleWindowUnload=function(){return this._xhr.abort()},e}()}),t.define("parse-headers/parse-headers",function(e,n,r,o){var i=t("trim"),u=t("for-each"),s=function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports=function(e){if(!e)return{};var t={};return u(i(e).split("\n"),function(e){var n=e.indexOf(":"),r=i(e.slice(0,n)).toLowerCase(),o=i(e.slice(n+1));"undefined"==typeof t[r]?t[r]=o:s(t[r])?t[r].push(o):t[r]=[t[r],o]}),t}}),t.define("trim",function(e,t,n,r){function o(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=o,t.left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}),t.define("for-each",function(e,n,r,o){function i(e,t,n){if(!a(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===f.call(e)?u(e,t,n):"string"==typeof e?s(e,t,n):c(e,t,n)}function u(e,t,n){for(var r=0,o=e.length;o>r;r++)l.call(e,r)&&t.call(n,e[r],r,e)}function s(e,t,n){for(var r=0,o=e.length;o>r;r++)t.call(n,e.charAt(r),r,e)}function c(e,t,n){for(var r in e)l.call(e,r)&&t.call(n,e[r],r,e)}var a=t("is-function");e.exports=i;var f=Object.prototype.toString,l=Object.prototype.hasOwnProperty}),t.define("is-function",function(e,t,n,r){function o(e){var t=i.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}e.exports=o;var i=Object.prototype.toString}),t.define("broken/lib",function(e,n,r,o){var i,u;i=t("zousan/zousan-min"),i.suppressUncaughtRejectionError=!0,u=function(){function e(e){this.state=e.state,this.value=e.value,this.reason=e.reason}return e.prototype.isFulfilled=function(){return"fulfilled"===this.state},e.prototype.isRejected=function(){return"rejected"===this.state},e}(),i.reflect=function(e){return new i(function(t,n){return e.then(function(e){return t(new u({state:"fulfilled",value:e}))})["catch"](function(e){return t(new u({state:"rejected",reason:e}))})})},i.settle=function(e){return i.all(e.map(i.reflect))},i.prototype.callback=function(e){return"function"==typeof e&&(this.then(function(t){return e(null,t)}),this["catch"](function(t){return e(t,null)})),this},e.exports=i}),t.define("zousan/zousan-min",function(t,n,r,o){!function(e){"use strict";function n(e){if(e){var t=this;e(function(e){t.resolve(e)},function(e){t.reject(e)})}}function r(e,t){if("function"==typeof e.y)try{var n=e.y.call(u,t);e.p.resolve(n)}catch(r){e.p.reject(r)}else e.p.resolve(t)}function o(e,t){if("function"==typeof e.n)try{var n=e.n.call(u,t);e.p.resolve(n)}catch(r){e.p.reject(r)}else e.p.reject(t)}var i,u,s="fulfilled",c="rejected",a="undefined",f=function(){function e(){for(;t.length-n;)t[n](),n++,n>1024&&(t.splice(0,n),n=0)}var t=[],n=0,r=function(){if(typeof MutationObserver!==a){var t=document.createElement("div"),n=new MutationObserver(e);return n.observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}return typeof setImmediate!==a?function(){setImmediate(e)}:function(){setTimeout(e,0)}}();return function(e){t.push(e),t.length-n==1&&r()}}();n.prototype={resolve:function(e){if(this.state===i){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var n=!0,o=e.then;if("function"==typeof o)return void o.call(e,function(e){n&&(n=!1,t.resolve(e))},function(e){n&&(n=!1,t.reject(e))})}catch(u){return void(n&&this.reject(u))}this.state=s,this.v=e,t.c&&f(function(){for(var n=0,o=t.c.length;o>n;n++)r(t.c[n],e)})}},reject:function(e){if(this.state===i){this.state=c,this.v=e;var t=this.c;t?f(function(){for(var n=0,r=t.length;r>n;n++)o(t[n],e)}):n.suppressUncaughtRejectionError||console.log("You upset Zousan. Please catch rejections: ",e,e.stack)}},then:function(e,t){var u=new n,c={y:e,n:t,p:u};if(this.state===i)this.c?this.c.push(c):this.c=[c];else{var a=this.state,l=this.v;f(function(){a===s?r(c,l):o(c,l)})}return u},"catch":function(e){return this.then(null,e)},"finally":function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var r=this;return new n(function(n,o){setTimeout(function(){o(Error(t))},e),r.then(function(e){n(e)},function(e){o(e)})})}},n.resolve=function(e){var t=new n;return t.resolve(e),t},n.reject=function(e){var t=new n;return t.reject(e),t},n.all=function(e){function t(t,u){"function"!=typeof t.then&&(t=n.resolve(t)),t.then(function(t){r[u]=t,o++,o==e.length&&i.resolve(r)},function(e){i.reject(e)})}for(var r=[],o=0,i=new n,u=0;u<e.length;u++)t(e[u],u);return e.length||i.resolve(r),i},typeof t!=a&&t.exports&&(t.exports=n),e.Zousan=n,n.soon=f}("undefined"!=typeof e?e:this)}),t.define("./crowdstart",function(e,n,r,o){var i,u,s,c,a,f,l;i=t("./client"),s=t("./api"),a=t("cookies-js/dist/cookies"),l=t("./utils").statusOk,f="crowdstart-session",c="",e.exports=u=function(){function e(e){var t,n;this.key=e,this.client=new i(this.key);for(t in s)n=s[t],addApi(t,n)}return e.prototype.addApi=function(e,t){var n,r,o;o=[];for(r in t)n=t[r],o.push(function(t,n){var r,o,i,u;return isFunction(n)?void(this[e][t]=function(){return n.apply(this,arguments)}):(i="string"==typeof n.uri?function(e){return n.uri}:n.uri,r=n.expects,o=n.method,u=n.process,null==r&&(r=l),null==o&&(o="POST"),this[e][t]=function(e){return function(t,n){var s;return s=i.call(e,t),e.client.request(s,t,o).then(function(e){return null!=e.error?newError(t,e):r(e)?(null!=u&&u.call(this,e),e):newError(t,e)}).callback(n)}}(this))}(r,n));return o},e.prototype.setToken=function(e){return"file:"===window.location.protocol?c=e:a.set(f,e,{expires:604800})},e.prototype.getToken=function(){var e;return"file:"===window.location.protocol?c:null!=(e=a.get(f))?e:""},e.prototype.setKey=function(e){return this.client.key=e},e.prototype.setStore=function(e){return this.storeId=e},e}()}),t.define("./api",function(e,n,r,o){var i,u,s,c;i=t("./utils").isFunction,s=function(e){return 200===e.status},u=function(e){return 201===e.status},c=function(e){return function(t){var n;return n=i(e)?e(t):e,null!=this.storeId?"/store/"+this.storeId+n:n}},e.exports={user:{exists:{uri:function(e){var t,n,r;return"/account/exists/"+(null!=(t=null!=(n=null!=(r=e.email)?r:e.username)?n:e.id)?t:e)},method:"GET",expects:s,process:function(e){return e.data.exists}},create:{uri:"/account/create",method:"POST",expects:s},createConfirm:{uri:function(e){return"/account/create/confirm/"+e.tokenId},method:"POST",expects:s},login:{uri:"/account/login",method:"POST",expects:s,process:function(e){return this.setToken(e.data.token),e}},logout:function(){return this.setToken("")},reset:{uri:function(e){return"/account/reset?email="+e.email},method:"POST",expects:s},resetConfirm:{uri:function(e){return"/account/reset/confirm/"+e.tokenId},method:"POST",expects:s},account:{uri:"/account",method:"GET",expects:s},updateAccount:{uri:"/account",method:"PATCH",expects:s}},payment:{authorize:{uri:c("/authorize"),method:"POST",expects:s},capture:{uri:storeId(function(e){return"/capture/"+e.orderId}),method:"POST",expects:s},charge:{uri:storeId("/charge"),method:"POST",expects:s},paypal:{uri:storeId("/paypal/pay"),method:"POST",expects:s},newReferrer:function(){return{uri:"/referrer",method:"POST",expects:u}}},util:{product:{uri:storeId(function(e){var t;return null!=(t="/product/"+e.id)?t:e}),method:"GET",expects:s},coupon:function(e,t,n){return{uri:storeId(function(e){var t;return null!=(t="/coupon/"+e.id)?t:e}),method:"GET",expects:s}}}}}),t.define("./utils",function(e,t,n,r){t.isFunction=function(e){return"function"==typeof e},t.isString=function(e){return"string"==typeof e},t.statusOk=function(e){return 200===e.status},t.statusCreated=function(e){return 201===e.status},t.newError=function(e,t){var n;return null!=t.error?(n=new Error(t.error.message),n.message=t.error.message):(n=new Error("Request failed"),n.message="Request failed"),n.req=e,n.res=t,t.data=t.data,n.status=t.status,n.type=t.error.type,n}}),t.define("cookies-js/dist/cookies",function(e,t,n,r){!function(n,r){"use strict";var o=function(e){if("object"!=typeof e.document)throw new Error("Cookies.js requires a `window` with a `document` object");var t=function(e,n,r){return 1===arguments.length?t.get(e):t.set(e,n,r)};return t._document=e.document,t._cacheKeyPrefix="cookey.",t._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),t.defaults={path:"/",secure:!1},t.get=function(e){t._cachedDocumentCookie!==t._document.cookie&&t._renewCache();var n=t._cache[t._cacheKeyPrefix+e];return n===r?r:decodeURIComponent(n)},t.set=function(e,n,o){return o=t._getExtendedOptions(o),o.expires=t._getExpiresDate(n===r?-1:o.expires),t._document.cookie=t._generateCookieString(e,n,o),t},t.expire=function(e,n){return t.set(e,r,n)},t._getExtendedOptions=function(e){return{path:e&&e.path||t.defaults.path,domain:e&&e.domain||t.defaults.domain,expires:e&&e.expires||t.defaults.expires,secure:e&&e.secure!==r?e.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){if(n=n||new Date,"number"==typeof e?e=e===1/0?t._maxExpireDate:new Date(n.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){e=e.replace(/[^#$&+\^`|]/g,encodeURIComponent),e=e.replace(/\(/g,"%28").replace(/\)/g,"%29"),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),n=n||{};var r=e+"="+t;return r+=n.path?";path="+n.path:"",r+=n.domain?";domain="+n.domain:"",r+=n.expires?";expires="+n.expires.toUTCString():"",r+=n.secure?";secure":""},t._getCacheFromString=function(e){for(var n={},o=e?e.split("; "):[],i=0;i<o.length;i++){var u=t._getKeyValuePairFromCookieString(o[i]);n[t._cacheKeyPrefix+u.key]===r&&(n[t._cacheKeyPrefix+u.key]=u.value)}return n},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");t=0>t?e.length:t;var n,r=e.substr(0,t);try{n=decodeURIComponent(r)}catch(o){console&&"function"==typeof console.error&&console.error('Could not decode cookie with key "'+r+'"',o)}return{key:n,value:e.substr(t+1)}},t._renewCache=function(){t._cache=t._getCacheFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){var e="cookies.js",n="1"===t.set(e,1).get(e);return t.expire(e),n},t.enabled=t._areEnabled(),t},i="object"==typeof n.document?o(n):o;"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof t?("object"==typeof e&&"object"==typeof e.exports&&(t=e.exports=i),t.Cookies=i):n.Cookies=i}("undefined"==typeof window?this:window)}),t.define("./index",function(n,r,o,i){var u,s;u=t("./client"),s=t("./crowdstart"),e.Crowdstart=s,e.Crowdstart.Client=u}),t("./index")}).call(this,this);
