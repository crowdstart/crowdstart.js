(function(global){var process={title:"browser",browser:true,env:{},argv:[],nextTick:function(fn){setTimeout(fn,0)},cwd:function(){return"/"},chdir:function(){}};function require(file,callback){if({}.hasOwnProperty.call(require.cache,file))return require.cache[file];if(typeof callback=="function"){require.load(file,callback);return}var resolved=require.resolve(file);if(!resolved)throw new Error("Failed to resolve module "+file);var module$={id:file,require:require,filename:file,exports:{},loaded:false,parent:null,children:[]};var dirname=file.slice(0,file.lastIndexOf("/")+1);require.cache[file]=module$.exports;resolved.call(module$.exports,module$,module$.exports,dirname,file);module$.loaded=true;return require.cache[file]=module$.exports}require.modules={};require.cache={};require.resolve=function(file){return{}.hasOwnProperty.call(require.modules,file)?require.modules[file]:void 0};require.define=function(file,fn){require.modules[file]=fn};global.require=require;require.define("./client",function(module,exports,__dirname,__filename){var Client;module.exports=Client=function(){Client.prototype.debug=false;Client.prototype.endpoint="https://api.crowdstart.com";function Client(key){this.key=key}Client.prototype.request=function(uri,data,method,token){var opts;if(method==null){method="POST"}if(token==null){token=this.key}opts={url:this.endpoint.replace(/\/$/,"")+uri+"?token="+token,method:method,data:JSON.stringify(data)};if(this.debug){console.log("REQUEST HEADER:",opts)}return(new Xhr).send(opts).then(function(res){res.data=res.responseText;return res})["catch"](function(err){throw newError(data,err)})};return Client}()});require.define("./crowdstart",function(module,exports,__dirname,__filename){var Client,Crowdstart,api,cachedToken,cookies,sessionTokenName,statusOk;Client=require("./client");api=require("./api");cookies=require("cookies-js/dist/cookies");statusOk=require("./utils").statusOk;sessionTokenName="crowdstart-session";cachedToken="";module.exports=Crowdstart=function(){function Crowdstart(key1){var k,v;this.key=key1;this.client=new Client(this.key);for(k in api){v=api[k];addApi(k,v)}}Crowdstart.prototype.addApi=function(api,blueprints){var blueprint,name,results;results=[];for(name in blueprints){blueprint=blueprints[name];results.push(function(name,blueprint){var expects,method,mkuri,process;if(isFunction(blueprint)){this[api][name]=function(){return blueprint.apply(this,arguments)};return}if(typeof blueprint.uri==="string"){mkuri=function(res){return blueprint.uri}}else{mkuri=blueprint.uri}expects=blueprint.expects,method=blueprint.method,process=blueprint.process;if(expects==null){expects=statusOk}if(method==null){method="POST"}return this[api][name]=function(_this){return function(data,cb){var uri;uri=mkuri.call(_this,data);return _this.client.request(uri,data,method).then(function(res){if(res.error!=null){return newError(data,res)}if(!expects(res)){return newError(data,res)}if(process!=null){process.call(this,res)}return res}).callback(cb)}}(this)}(name,blueprint))}return results};Crowdstart.prototype.setToken=function(token){if(window.location.protocol==="file:"){return cachedToken=token}return cookies.set(sessionTokenName,token,{expires:604800})};Crowdstart.prototype.getToken=function(){var ref;if(window.location.protocol==="file:"){return cachedToken}return(ref=cookies.get(sessionTokenName))!=null?ref:""};Crowdstart.prototype.setKey=function(key){return this.client.key=key};Crowdstart.prototype.setStore=function(id){return this.storeId=id};return Crowdstart}()});require.define("./api",function(module,exports,__dirname,__filename){var isFunction,ref,statusCreated,statusOk,storeUri;ref=require("./utils"),isFunction=ref.isFunction,statusOk=ref.statusOk,statusCreated=ref.statusCreated;storeUri=function(u){return function(x){var uri;if(isFunction(u)){uri=u(x)}else{uri=u}if(this.storeId!=null){return"/store/"+this.storeId+uri}else{return uri}}};module.exports={user:{exists:{uri:function(x){var ref1,ref2,ref3;return"/account/exists/"+((ref1=(ref2=(ref3=x.email)!=null?ref3:x.username)!=null?ref2:x.id)!=null?ref1:x)},method:"GET",process:function(res){return res.data.exists}},create:{uri:"/account/create"},createConfirm:{uri:function(x){return"/account/create/confirm/"+x.tokenId}},login:{uri:"/account/login",process:function(res){this.setToken(res.data.token);return res}},logout:function(){return this.setToken("")},reset:{uri:function(x){return"/account/reset?email="+x.email}},resetConfirm:{uri:function(x){return"/account/reset/confirm/"+x.tokenId}},account:{uri:"/account",method:"GET"},updateAccount:{uri:"/account",method:"PATCH"}},payment:{authorize:{uri:storeUri("/authorize")},capture:function(data,success,fail){return{uri:storeId(function(x){return"/capture/"+x.orderId})}},charge:function(data,success,fail){return{uri:storeId("/charge")}},paypal:function(data,success,fail){return{uri:storeId("/paypal/pay")}},newReferrer:function(){return{uri:"/referrer",expects:statusCreated}}},util:{product:{uri:storeId(function(x){var ref1;return(ref1="/product/"+x.id)!=null?ref1:x}),method:"GET"},coupon:function(code,success,fail){return{uri:storeId(function(x){var ref1;return(ref1="/coupon/"+x.id)!=null?ref1:x}),method:"GET"}}}}});require.define("./utils",function(module,exports,__dirname,__filename){exports.isFunction=function(fn){return typeof fn==="function"};exports.isString=function(s){return typeof s==="string"};exports.statusOk=function(res){return res.status===200};exports.statusCreated=function(res){return res.status===201};exports.newError=function(data,res){var err;if(res.error!=null){err=new Error(res.error.message);err.message=res.error.message}else{err=new Error("Request failed");err.message="Request failed"}err.req=data;err.res=res;res.data=res.data;err.status=res.status;err.type=res.error.type;return err}});require.define("cookies-js/dist/cookies",function(module,exports,__dirname,__filename){(function(global,undefined){"use strict";var factory=function(window){if(typeof window.document!=="object"){throw new Error("Cookies.js requires a `window` with a `document` object")}var Cookies=function(key,value,options){return arguments.length===1?Cookies.get(key):Cookies.set(key,value,options)};Cookies._document=window.document;Cookies._cacheKeyPrefix="cookey.";Cookies._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC");Cookies.defaults={path:"/",secure:false};Cookies.get=function(key){if(Cookies._cachedDocumentCookie!==Cookies._document.cookie){Cookies._renewCache()}var value=Cookies._cache[Cookies._cacheKeyPrefix+key];return value===undefined?undefined:decodeURIComponent(value)};Cookies.set=function(key,value,options){options=Cookies._getExtendedOptions(options);options.expires=Cookies._getExpiresDate(value===undefined?-1:options.expires);Cookies._document.cookie=Cookies._generateCookieString(key,value,options);return Cookies};Cookies.expire=function(key,options){return Cookies.set(key,undefined,options)};Cookies._getExtendedOptions=function(options){return{path:options&&options.path||Cookies.defaults.path,domain:options&&options.domain||Cookies.defaults.domain,expires:options&&options.expires||Cookies.defaults.expires,secure:options&&options.secure!==undefined?options.secure:Cookies.defaults.secure}};Cookies._isValidDate=function(date){return Object.prototype.toString.call(date)==="[object Date]"&&!isNaN(date.getTime())};Cookies._getExpiresDate=function(expires,now){now=now||new Date;if(typeof expires==="number"){expires=expires===Infinity?Cookies._maxExpireDate:new Date(now.getTime()+expires*1e3)}else if(typeof expires==="string"){expires=new Date(expires)}if(expires&&!Cookies._isValidDate(expires)){throw new Error("`expires` parameter cannot be converted to a valid Date instance")}return expires};Cookies._generateCookieString=function(key,value,options){key=key.replace(/[^#$&+\^`|]/g,encodeURIComponent);key=key.replace(/\(/g,"%28").replace(/\)/g,"%29");value=(value+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent);options=options||{};var cookieString=key+"="+value;cookieString+=options.path?";path="+options.path:"";cookieString+=options.domain?";domain="+options.domain:"";cookieString+=options.expires?";expires="+options.expires.toUTCString():"";cookieString+=options.secure?";secure":"";return cookieString};Cookies._getCacheFromString=function(documentCookie){var cookieCache={};var cookiesArray=documentCookie?documentCookie.split("; "):[];for(var i=0;i<cookiesArray.length;i++){var cookieKvp=Cookies._getKeyValuePairFromCookieString(cookiesArray[i]);if(cookieCache[Cookies._cacheKeyPrefix+cookieKvp.key]===undefined){cookieCache[Cookies._cacheKeyPrefix+cookieKvp.key]=cookieKvp.value}}return cookieCache};Cookies._getKeyValuePairFromCookieString=function(cookieString){var separatorIndex=cookieString.indexOf("=");separatorIndex=separatorIndex<0?cookieString.length:separatorIndex;var key=cookieString.substr(0,separatorIndex);var decodedKey;try{decodedKey=decodeURIComponent(key)}catch(e){if(console&&typeof console.error==="function"){console.error('Could not decode cookie with key "'+key+'"',e)}}return{key:decodedKey,value:cookieString.substr(separatorIndex+1)}};Cookies._renewCache=function(){Cookies._cache=Cookies._getCacheFromString(Cookies._document.cookie);Cookies._cachedDocumentCookie=Cookies._document.cookie};Cookies._areEnabled=function(){var testKey="cookies.js";var areEnabled=Cookies.set(testKey,1).get(testKey)==="1";Cookies.expire(testKey);return areEnabled};Cookies.enabled=Cookies._areEnabled();return Cookies};var cookiesExport=typeof global.document==="object"?factory(global):factory;if(typeof define==="function"&&define.amd){define(function(){return cookiesExport})}else if(typeof exports==="object"){if(typeof module==="object"&&typeof module.exports==="object"){exports=module.exports=cookiesExport}exports.Cookies=cookiesExport}else{global.Cookies=cookiesExport}})(typeof window==="undefined"?this:window)});require.define("./index",function(module,exports,__dirname,__filename){var Client,Crowdstart;Client=require("./client");Crowdstart=require("./crowdstart");global.Crowdstart=Crowdstart;global.Crowdstart.Client=Client});require("./index")}).call(this,this);
