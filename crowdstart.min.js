(function(t){function e(t,n){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];if("function"==typeof n)return void e.load(t,n);var r=e.resolve(t);if(!r)throw new Error("Failed to resolve module "+t);var o={id:t,require:e,filename:t,exports:{},loaded:!1,parent:null,children:[]},i=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=o.exports,r.call(o.exports,o,o.exports,i,t),o.loaded=!0,e.cache[t]=o.exports}e.modules={},e.cache={},e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,n){e.modules[t]=n},e.waiting={},e.async=function(t,n){for(e.modules[t]=n;cb=e.waiting[t].shift();)cb(e(t))},e.load=function(t,n){var r=document.createElement("script"),o=document.getElementsByTagName("script")[0],i=e.waiting[t]=e.waiting[t]||[];i.push(n),r.type="text/javascript",r.async=!0,r.src=t,o.parentNode.insertBefore(r,o)},e.define("./api",function(t,n,r,o){var i,u,s,c,a,l;u=e("js-cookie/src/js.cookie"),a=e("./utils"),s=a.isFunction,c=a.newError,l=a.statusOk,t.exports=i=function(){function t(e){var n,r,o,i,u,s,c;if(null==e&&(e={}),!(this instanceof t))return function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(t,arguments,function(){});i=e.endpoint,o=e.debug,s=e.key,r=e.client,n=e.blueprints,this.debug=o,null==n&&(n=t.BLUEPRINTS),r?this.client=r:this.client=new t.CLIENT({debug:o,endpoint:i,key:s});for(u in n)c=n[u],this.addBlueprints(u,c)}return t.SESSION_NAME="crowdstart-session",t.BLUEPRINTS={},t.CLIENT=function(){},t.prototype.addBlueprints=function(t,e){var n,r,o;null==this[t]&&(this[t]={}),o=[];for(r in e)n=e[r],o.push(function(e){return function(n,r){var o,i,u,a;return s(r)?void(e[t][n]=function(){return r.apply(e,arguments)}):(u="string"==typeof r.uri?function(t){return r.uri}:r.uri,o=r.expects,i=r.method,a=r.process,null==o&&(o=l),null==i&&(i="POST"),e[t][n]=function(t,n){var r;return r=u.call(e,t),e.client.request(r,t,i).then(function(n){var r;if(null!=(null!=(r=n.data)?r.error:void 0))throw c(t,n);if(!o(n))throw c(t,n);return null!=a&&a.call(e,n),n}).callback(n)})}}(this)(r,n));return o},t.prototype.setKey=function(t){return this.client.setKey(t)},t.prototype.setUserKey=function(e){return u.set(t.SESSION_NAME,e,{expires:604800}),this.client.setUserKey(e)},t.prototype.getUserKey=function(){var e;return null!=(e=u.get(t.SESSION_NAME))?e:""},t.prototype.setStore=function(t){return this.storeId=t},t}()}),e.define("js-cookie/src/js.cookie",function(t,e,n,r){!function(n){if("function"==typeof define&&define.amd)define(n);else if("object"==typeof e)t.exports=n();else{var r=window.Cookies,o=window.Cookies=n();o.noConflict=function(){return window.Cookies=r,o}}}(function(){function t(){for(var t=0,e={};t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function e(n){function r(e,o,i){var u;if(arguments.length>1){if(i=t({path:"/"},r.defaults,i),"number"==typeof i.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s}try{u=JSON.stringify(o),/^[\{\[]/.test(u)&&(o=u)}catch(c){}return o=encodeURIComponent(String(o)),o=o.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)),e=e.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),e=e.replace(/[\(\)]/g,escape),document.cookie=[e,"=",o,i.expires&&"; expires="+i.expires.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure?"; secure":""].join("")}e||(u={});for(var a=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,f=0;f<a.length;f++){var p=a[f].split("="),d=p[0].replace(l,decodeURIComponent),h=p.slice(1).join("=");'"'===h.charAt(0)&&(h=h.slice(1,-1));try{if(h=n&&n(h,d)||h.replace(l,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(c){}if(e===d){u=h;break}e||(u[d]=h)}catch(c){}}return u}return r.get=r.set=r,r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(e,n){r(e,"",t(n,{expires:-1}))},r.withConverter=e,r}return e()})}),e.define("./utils",function(t,e,n,r){e.isFunction=function(t){return"function"==typeof t},e.isString=function(t){return"string"==typeof t},e.statusOk=function(t){return 200===t.status},e.statusCreated=function(t){return 201===t.status},e.statusNoContent=function(t){return 204===t.status},e.newError=function(t,e){var n,r,o,i,u,s,c;return r=null!=(o=null!=e&&null!=(i=e.data)&&null!=(u=i.error)?u.message:void 0)?o:"Request failed",n=new Error(r),n.message=r,n.req=t,n.res=e,n.data=e.data,n.responseText=e.data,n.status=e.status,n.type=null!=(s=e.data)&&null!=(c=s.error)?c.type:void 0,n}}),e.define("./client/xhr",function(t,n,r,o){var i,u;u=e("xhr-promise-es6/lib"),u.Promise=e("broken/lib"),t.exports=i=function(){function t(e){var n;return n=null!=e?e:{},this.key=n.key,this.endpoint=n.endpoint,this.debug=n.debug,this instanceof t?void 0:new t(this.key)}return t.prototype.debug=!1,t.prototype.endpoint="https://api.crowdstart.com",t.prototype.setKey=function(t){return this.key=t},t.prototype.setUserKey=function(t){return this.userKey=t},t.prototype.getKey=function(){return this.userKey||this.key},t.prototype.request=function(t,e,n,r){var o;return null==n&&(n="POST"),null==r&&(r=this.getKey()),o={url:this.endpoint.replace(/\/$/,"")+t+"?token="+r,method:n,data:JSON.stringify(e)},this.debug&&console.log("REQUEST HEADER:",o),(new u).send(o).then(function(t){return t.data=t.responseText,t})["catch"](function(t){var n,r,o;try{t.data=null!=(o=t.responseText)?o:JSON.parse(t.xhr.responseText)}catch(r){n=r}throw newError(e,t)})},t}()}),e.define("xhr-promise-es6/lib",function(t,n,r,o){var i,u;i=e("parse-headers/parse-headers"),t.exports=u=function(){function t(){}return t.DEFAULT_CONTENT_TYPE="application/x-www-form-urlencoded; charset=UTF-8",t.Promise=Promise,t.prototype.send=function(t){var e;return null==t&&(t={}),e={method:"GET",data:null,headers:{},async:!0,username:null,password:null},t=Object.assign({},e,t),new this.constructor.Promise(function(e){return function(n,r){var o,i,u,s,c;if(!XMLHttpRequest)return void e._handleError("browser",r,null,"browser doesn't support XMLHttpRequest");if("string"!=typeof t.url||0===t.url.length)return void e._handleError("url",r,null,"URL is a required parameter");e._xhr=c=new XMLHttpRequest,c.onload=function(){var t;e._detachWindowUnload();try{t=e._getResponseText()}catch(o){return void e._handleError("parse",r,null,"invalid JSON response")}return n({url:e._getResponseUrl(),status:c.status,statusText:c.statusText,responseText:t,headers:e._getHeaders(),xhr:c})},c.onerror=function(){return e._handleError("error",r)},c.ontimeout=function(){return e._handleError("timeout",r)},c.onabort=function(){return e._handleError("abort",r)},e._attachWindowUnload(),c.open(t.method,t.url,t.async,t.username,t.password),null==t.data||t.headers["Content-Type"]||(t.headers["Content-Type"]=e.constructor.DEFAULT_CONTENT_TYPE),u=t.headers;for(i in u)s=u[i],c.setRequestHeader(i,s);try{return c.send(t.data)}catch(a){return o=a,e._handleError("send",r,null,o.toString())}}}(this))},t.prototype.getXHR=function(){return this._xhr},t.prototype._attachWindowUnload=function(){return this._unloadHandler=this._handleWindowUnload.bind(this),window.attachEvent?window.attachEvent("onunload",this._unloadHandler):void 0},t.prototype._detachWindowUnload=function(){return window.detachEvent?window.detachEvent("onunload",this._unloadHandler):void 0},t.prototype._getHeaders=function(){return i(this._xhr.getAllResponseHeaders())},t.prototype._getResponseText=function(){var t;switch(t="string"==typeof this._xhr.responseText?this._xhr.responseText:"",this._xhr.getResponseHeader("Content-Type")){case"application/json":case"text/javascript":t=JSON.parse(t+"")}return t},t.prototype._getResponseUrl=function(){return null!=this._xhr.responseURL?this._xhr.responseURL:/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())?this._xhr.getResponseHeader("X-Request-URL"):""},t.prototype._handleError=function(t,e,n,r){return this._detachWindowUnload(),e({reason:t,status:n||this._xhr.status,statusText:r||this._xhr.statusText,xhr:this._xhr})},t.prototype._handleWindowUnload=function(){return this._xhr.abort()},t}()}),e.define("parse-headers/parse-headers",function(t,n,r,o){var i=e("trim"),u=e("for-each"),s=function(t){return"[object Array]"===Object.prototype.toString.call(t)};t.exports=function(t){if(!t)return{};var e={};return u(i(t).split("\n"),function(t){var n=t.indexOf(":"),r=i(t.slice(0,n)).toLowerCase(),o=i(t.slice(n+1));"undefined"==typeof e[r]?e[r]=o:s(e[r])?e[r].push(o):e[r]=[e[r],o]}),e}}),e.define("trim",function(t,e,n,r){function o(t){return t.replace(/^\s*|\s*$/g,"")}e=t.exports=o,e.left=function(t){return t.replace(/^\s*/,"")},e.right=function(t){return t.replace(/\s*$/,"")}}),e.define("for-each",function(t,n,r,o){function i(t,e,n){if(!a(e))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===l.call(t)?u(t,e,n):"string"==typeof t?s(t,e,n):c(t,e,n)}function u(t,e,n){for(var r=0,o=t.length;o>r;r++)f.call(t,r)&&e.call(n,t[r],r,t)}function s(t,e,n){for(var r=0,o=t.length;o>r;r++)e.call(n,t.charAt(r),r,t)}function c(t,e,n){for(var r in t)f.call(t,r)&&e.call(n,t[r],r,t)}var a=e("is-function");t.exports=i;var l=Object.prototype.toString,f=Object.prototype.hasOwnProperty}),e.define("is-function",function(t,e,n,r){function o(t){var e=i.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}t.exports=o;var i=Object.prototype.toString}),e.define("broken/lib",function(t,n,r,o){var i,u;i=e("zousan/zousan-min"),i.suppressUncaughtRejectionError=!0,u=function(){function t(t){this.state=t.state,this.value=t.value,this.reason=t.reason}return t.prototype.isFulfilled=function(){return"fulfilled"===this.state},t.prototype.isRejected=function(){return"rejected"===this.state},t}(),i.reflect=function(t){return new i(function(e,n){return t.then(function(t){return e(new u({state:"fulfilled",value:t}))})["catch"](function(t){return e(new u({state:"rejected",reason:t}))})})},i.settle=function(t){return i.all(t.map(i.reflect))},i.prototype.callback=function(t){return"function"==typeof t&&(this.then(function(e){return t(null,e)}),this["catch"](function(e){return t(e,null)})),this},t.exports=i}),e.define("zousan/zousan-min",function(e,n,r,o){!function(t){"use strict";function n(t){if(t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function r(t,e){if("function"==typeof t.y)try{var n=t.y.call(u,e);t.p.resolve(n)}catch(r){t.p.reject(r)}else t.p.resolve(e)}function o(t,e){if("function"==typeof t.n)try{var n=t.n.call(u,e);t.p.resolve(n)}catch(r){t.p.reject(r)}else t.p.reject(e)}var i,u,s="fulfilled",c="rejected",a="undefined",l=function(){function t(){for(;e.length-n;)e[n](),n++,n>1024&&(e.splice(0,n),n=0)}var e=[],n=0,r=function(){if(typeof MutationObserver!==a){var e=document.createElement("div"),n=new MutationObserver(t);return n.observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return typeof setImmediate!==a?function(){setImmediate(t)}:function(){setTimeout(t,0)}}();return function(t){e.push(t),e.length-n==1&&r()}}();n.prototype={resolve:function(t){if(this.state===i){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==typeof t))try{var n=!0,o=t.then;if("function"==typeof o)return void o.call(t,function(t){n&&(n=!1,e.resolve(t))},function(t){n&&(n=!1,e.reject(t))})}catch(u){return void(n&&this.reject(u))}this.state=s,this.v=t,e.c&&l(function(){for(var n=0,o=e.c.length;o>n;n++)r(e.c[n],t)})}},reject:function(t){if(this.state===i){this.state=c,this.v=t;var e=this.c;e?l(function(){for(var n=0,r=e.length;r>n;n++)o(e[n],t)}):n.suppressUncaughtRejectionError||console.log("You upset Zousan. Please catch rejections: ",t,t.stack)}},then:function(t,e){var u=new n,c={y:t,n:e,p:u};if(this.state===i)this.c?this.c.push(c):this.c=[c];else{var a=this.state,f=this.v;l(function(){a===s?r(c,f):o(c,f)})}return u},"catch":function(t){return this.then(null,t)},"finally":function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var r=this;return new n(function(n,o){setTimeout(function(){o(Error(e))},t),r.then(function(t){n(t)},function(t){o(t)})})}},n.resolve=function(t){var e=new n;return e.resolve(t),e},n.reject=function(t){var e=new n;return e.reject(t),e},n.all=function(t){function e(e,u){"function"!=typeof e.then&&(e=n.resolve(e)),e.then(function(e){r[u]=e,o++,o==t.length&&i.resolve(r)},function(t){i.reject(t)})}for(var r=[],o=0,i=new n,u=0;u<t.length;u++)e(t[u],u);return t.length||i.resolve(r),i},typeof e!=a&&e.exports&&(e.exports=n),t.Zousan=n,n.soon=l}("undefined"!=typeof t?t:this)}),e.define("./blueprints/browser",function(t,n,r,o){var i,u,s,c,a,l,f,p,d,h,v,y,g,w,m;for(h=e("./utils"),l=h.isFunction,y=h.statusCreated,g=h.statusNoContent,w=h.statusOk,v=e("./blueprints/uri"),u=v.byId,m=v.storePrefixed,s=function(t){var e;return e="/"+t,{list:{uri:e,method:"GET"},get:{uri:u(t),method:"GET"}}},i={account:{get:{uri:"/account",method:"GET"},update:{uri:"/account",method:"PATCH"},exists:{uri:function(t){var e,n,r;return"/account/exists/"+(null!=(e=null!=(n=null!=(r=t.email)?r:t.username)?n:t.id)?e:t)},method:"GET",process:function(t){return t.data.exists}},create:{uri:"/account/create",expects:function(t){var e;return console.log("expects gets:",t),e=w(t)||y(t),console.log("expects:",e),e}},createConfirm:{uri:function(t){return"/account/create/confirm/"+t.tokenId}},login:{uri:"/account/login",process:function(t){return this.setUserKey(t.data.token),t}},logout:function(){return this.setUserKey("")},reset:{uri:function(t){return"/account/reset?email="+t.email}},resetConfirm:{uri:function(t){return"/account/reset/confirm/"+t.tokenId}}},checkout:{authorize:{uri:m("/authorize")},capture:{uri:m(function(t){return"/capture/"+t.orderId})},charge:{uri:m("/charge")},paypal:{uri:m("/paypal/pay")}},referrer:{create:{uri:"/referrer",expects:y}}},d=["coupon","collection","product","variant"],c=function(t){return i[t]=s(t)},a=0,f=d.length;f>a;a++)p=d[a],c(p);t.exports=i}),e.define("./blueprints/uri",function(t,n,r,o){var i,u;i=e("./utils").isFunction,n.storePrefixed=u=function(t){return function(e){var n;return n=i(t)?t(e):t,null!=this.storeId?"/store/"+this.storeId+n:n}},n.byId=function(t){switch(t){case"coupon":return u(function(t){var e;return"/coupon/"+(null!=(e=t.code)?e:t)});case"product":return u(function(t){var e,n;return"/product/"+(null!=(e=null!=(n=t.id)?n:t.slug)?e:t)});default:return function(e){var n;return t+"/"+(null!=(n=e.id)?n:e)}}}}),e.define("./browser",function(n,r,o,i){var u,s;null==t.Crowdstart&&(t.Crowdstart={}),u=e("./api"),s=e("./client/xhr"),u.CLIENT=s,u.BLUEPRINTS=e("./blueprints/browser"),Crowdstart.Api=u,Crowdstart.Client=s,n.exports=Crowdstart}),e("./browser")}).call(this,this);
